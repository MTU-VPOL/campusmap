<html>

<head>
   <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#285756" >
    <title>MTU Campus History App Demo</title>
  <script type="module" src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.esm.js"></script>
  <script nomodule src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@ionic/core/css/ionic.bundle.css" />
  <link rel="stylesheet" href="https://js.arcgis.com/4.28/esri/themes/light/main.css" />
  <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/openseadragon@4.1.0/build/openseadragon/openseadragon.min.js"></script>
  <script src="https://js.arcgis.com/4.28/"></script>

  <script>
    window.Ionic = {
      config: {
        mode: 'ios'
      }
    }
  </script>
</head>

  <style>      
    #viewDiv {
      text-align: center;
      height: 100%;
      width: 100%;           
    }

    ion-range {
      position: absolute;
      top: 5px;
      left: 10%;
      width:70%;
        --knob-box-shadow:  0 3px 1px rgba(0, 0, 0, 0.1), 0 4px 8px rgba(0, 0, 0, 0.13), 0 0 0 1px rgba(0, 0, 0, 0.02);
        --bar-background: black;
        --bar-background-active: #d7d8da;
        --bar-height: 8px;
        --bar-border-radius: 8px;
        --knob-background: #ffffff;
        --knob-size: 30px;
        --pin-background: #ffafcc;
        --pin-color: #fff; 
    }  

    swiper {
      width: 100%;
      height: 100%;
    }

    .swiper-slide {
      text-align: center;
      font-size: 18px;
      background: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .swiper-slide img {
      display: block;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .swiper-slide {
      width: 80%;
    }

    .swiper-slide:nth-child(2n) {
      width: 80%;
    }

    .swiper-slide:nth-child(3n) {
      width: 40%;
    }

   .esri-ui .esri-popup  {
     display:  none !important;
   }  



</style>

<body>
  <ion-app>
    <ion-header>
  <ion-toolbar>
     <ion-buttons slot="start">
            <ion-img src="images/husky.svg" style="width: 60px; height: 60px;"></ion-img>
          </ion-buttons>
    <ion-title>MTU Campus History Project Demo</ion-title>
  </ion-toolbar>
</ion-header>
<ion-content> 
    <ion-modal id="popupModal">
    <ion-header>
      <ion-toolbar>
        <ion-buttons slot="end">
          <ion-button onclick="cancel()" id="modalclose">CLOSE</ion-button>
        </ion-buttons>
        <ion-title><div id="modaltitle"></div></ion-title>       
      </ion-toolbar>
    </ion-header>
    <ion-content class="ion-padding">
      <ion-item>
        <div id='openseadragon1' style='width: 800px; height: 600px;'></div>
      </ion-item>
     
        <ion-item detail="true">
  <ion-label>
    <h3>Title</h3>
    <p><div id="phototitle"></div></p>
  </ion-label>
</ion-item>

<ion-item button>
  <ion-label>
    <h3>Location</h3>
    <p>Library of Congress</p>
  </ion-label>
</ion-item>

<ion-item button detail="true">
  <ion-label>
    <h3>Description</h3>
    <p><div id="desc"></div></p>
  </ion-label>
</ion-item>

<ion-item button detail="false">
  <ion-label>
    <h3>Date</h3>
    <p><div id="date"></div></p>
  </ion-label>
</ion-item>

<ion-item button detail="true" detail-icon="caret-forward-outline">
  <ion-label>
    <h3>Collection</h3>
    <p><div id="collection"></div></p>    
  </ion-label>
</ion-item>
      
    </ion-content>
  </ion-modal> 
  <ion-range value="100"></ion-range>
  <div id="viewDiv"></div>
</ion-content>

<ion-footer>
  <ion-toolbar>
    <!-- <ion-title>Footer Toolbar</ion-title> -->
    <!-- Slider main container -->
<div class="swiper mySwiper">
  <!-- Additional required wrapper -->
  <div class="swiper-wrapper">
    <!-- Slides -->
    <div class="swiper-slide">

      <ion-card>
        <img alt="Silhouette of mountains" style="width: 500px; height: 200px;" src="https://cchi.mtu.edu/system/files/styles/archives_watermark_test/private/d3b52f52-ce73-4475-812f-684f45cc54d5?itok=UNgJP5PY" />
        <ion-card-header>
          <ion-card-title>1908</ion-card-title>
          <ion-card-subtitle>MTU CAMPUS</ion-card-subtitle>
        </ion-card-header>
  <ion-card-content>
    Here's a small text description for how the MTU Campus changed in 1908.
  </ion-card-content>
</ion-card>
</div>
    <div class="swiper-slide">
      
      <ion-card>
        <img alt="Silhouette of mountains" style="width: 500px; height: 200px;" src="https://cchi.mtu.edu/system/files/styles/archives_watermark_test/private/d3b52f52-ce73-4475-812f-684f45cc54d5?itok=UNgJP5PY" />
  <ion-card-header>
    <ion-card-title>1949</ion-card-title>
    <ion-card-subtitle>MTU Campus</ion-card-subtitle>
  </ion-card-header>

  <ion-card-content>
    Here's a small text description for how the MTU Campus changed in 1949.
  </ion-card-content>
</ion-card>
    </div>
    <div class="swiper-slide">Slide 3</div>
    ...
  </div>
  <!-- If we need pagination -->
  <!-- <div class="swiper-pagination"></div> -->

  <!-- If we need navigation buttons -->
  <div class="swiper-button-prev"></div>
  <div class="swiper-button-next"></div>

  <!-- If we need scrollbar -->
  <!-- <div class="swiper-scrollbar"></div> -->
</div>    
  </ion-toolbar>
</ion-footer>
  </ion-app>
</body>
<script>

   var modal = document.querySelector('ion-modal');   

   $( "#modalclose" ).click(function() {
        modal.isOpen = false;
       });

   const viewer = OpenSeadragon({
        id: "openseadragon1",
        prefixUrl: "https://cdn.jsdelivr.net/npm/openseadragon@2.4/build/openseadragon/images/",
        tileSources: {
          type: "image",
          url: "https://cchi-iif.mtu.edu/iiif/3/campus.tif/full/max/0/default.jpg"
        }
    });


    <!-- Initialize Swiper -->
    var swiper = new Swiper(".mySwiper", {
      slidesPerView: "auto",
      spaceBetween: 30,
      navigation: {
        nextEl: ".swiper-button-next",
        prevEl: ".swiper-button-prev",
      },
      pagination: {
        el: ".swiper-pagination",
        clickable: true,
      },
    });


  require(["esri/Map", "esri/views/MapView", "esri/layers/TileLayer", "esri/layers/FeatureLayer", "esri/core/reactiveUtils"], (Map, MapView, TileLayer, FeatureLayer, reactiveUtils) => {

   

    // Define a pop-up for Trailheads
      const popupPhotos = {
        "title": "Image",
        "content": "<b>Title:</b> {Title}<br><b>City:</b> {CITY_JUR}<br><b>Cross Street:</b> {X_STREET}<br><b>Parking:</b> {PARKING}<br><b>Elevation:</b> {ELEV_FT} ft"
        
      }

    // tile layer that is currently visible on the map  
    let current_layer; 

     // renderer for the geoheritage reflections layer
    const renderer = {
     type: "simple",
     symbol: {
        type: "picture-marker",
        url: 'images/camera.png',
        width: 20,
        height: 20
     }
    }

    function setFeatureLayerFilter(expression) {
      photos_layer.definitionExpression = expression;  
    }
      
    // this is the campus map layer visible on app load
    current_layer = new TileLayer({
      url: "https://portal1-geo.sabu.mtu.edu:6443/arcgis/rest/services/KeweenawHSDI/KeTT_1908_FIPS/MapServer"
    }); 

    // this is the campus map layer visible on app load
    photos_layer = new FeatureLayer({
      url: "https://services2.arcgis.com/RPhrOu9XQzI31xTa/arcgis/rest/services/Historic_Campus_Photographs/FeatureServer/0",
      renderer: renderer, // specify the render created above
      outFields: ["*"],
      popUpEnabled: true,
      popupTemplate: popupPhotos
    }); 

    // Create the Map
    const map = new Map({
      basemap: "satellite",
      layers: [current_layer, photos_layer]
    });

    // Create the MapView
    const view = new MapView({
      center: [-88.5433574, 47.1166716],
      zoom: 15,
      container: "viewDiv",
      map: map
    });    

    // Removes the zoom widget from the view
    view.ui.remove("zoom"); 

    // use the range slider to change the opacity of overlay maps
    const range = document.querySelector('ion-range');    

    // get range value of the opacity slider   
    let rangeVal = $( "ion-range" ).val();
    current_layer.opacity = rangeVal / 100;
    range.addEventListener('ionInput', ({ detail }) => {                     
      current_layer.opacity = detail.value / 100; 
      console.log(detail.value);                 
    });

    const swiper = document.querySelector('.swiper').swiper;   

    swiper.on('slideChange', function () {

      current_layer.opacity = rangeVal / 100;
      const index = swiper.activeIndex;
      map.allLayers.filter(function(layer) {
        if (layer.type === "tile") {
          map.remove(layer);
        } 
      }); 
     console.log('slide changed', swiper.activeIndex);
     if (index == 0) {
      current_layer = new TileLayer({
        url: "https://portal1-geo.sabu.mtu.edu:6443/arcgis/rest/services/KeweenawHSDI/KeTT_1908_FIPS/MapServer"
      });

      setFeatureLayerFilter("map_year = '1955'");

      map.add(current_layer);
      
     } else if ( index == 1) {
      setFeatureLayerFilter("map_year = '1965'");
      current_layer = new TileLayer({
      url: "https://portal1-geo.sabu.mtu.edu:6443/arcgis/rest/services/KeweenawHSDI/Kett_19496_FIPS/MapServer"
      });
      console.log("index1");
      map.add(current_layer);
     }
     // push the current layer to the back
     map.reorder(photos_layer, 0);  
     map.reorder(current_layer, 0);
  });

 // Watch for a click on the Photolayer 
 reactiveUtils.watch(
  () => view.popup.selectedFeature,
  (graphic) => {
    if (graphic) {
      console.log(graphic);
      const title = graphic.attributes.Title;
      const desc = graphic.attributes.Description;
      const collection = graphic.attributes.Collection;
      const photographer = graphic.attributes.Photographer;
      const date = graphic.attributes.photo_date;
      const location = graphic.attributes.Location; 
      $('#phototitle').html("Academic Office Building");
      $('#modaltitle').html("Academic Office Building");
      $('#desc').html("Example photo of the AOB from the Library of Congress.");
      $('#collection').html("collection");
      $('#date').html(date);
      $('#location').html("Library of Congress");

      modal.isOpen = true;
    }
  });
});
</script>
</html>